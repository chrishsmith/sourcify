---
description: Enforce clean Next.js + Prisma project structure, documentation placement, and naming conventions
globs: 
  - "**/*"          # Apply broadly, or narrow e.g. "*.md", "src/**/*.tsx"
alwaysApply: false  # or true if you want it in EVERY prompt
---

# Project Structure & Organization Rule for Sourcify

## Folder Structure to Always Follow
- **Root**: Keep minimal → src/, prisma/, public/, _archive/, middleware.ts, next.config.*, package.json, tsconfig.json, .gitignore, README.md, CONTRIBUTING.md
- **src/app/**: Next.js App Router pages, layouts, route handlers (do NOT move)
- **src/components/**: Reusable UI (split into ui/, features/ if grows)
- **src/features/**: Group by business domain (e.g. features/classification/, features/compliance/)
- **src/services/**: Business logic, classification engine, utils
- **prisma/**: Keep as-is (migrations/, seed.ts, schema.prisma)
- **docs/**: All .md files — PRDs, roadmaps, architecture, progress
  - Rename to kebab-case (e.g. prd-trade-intelligence.md)
  - Subfolders: docs/ralph/ for agent logs (active guardrails only)
- **_archive/**: Top-level folder for ALL archived/superseded code (excluded from TypeScript)
  - `_archive/api/` - Old API routes
  - `_archive/services/` - Old engines, services
  - `_archive/components/` - Old UI components
  - `_archive/docs/` - Old docs, PRDs, ralph iteration logs
- **tests/** or **__tests__/**: Near code or centralized

## Key Rules
- No source code or docs scattered in root (except essentials)
- Move all .md → docs/ unless it's README.md or CONTRIBUTING.md at root (GitHub convention)
- Use kebab-case for new .md files and feature folders (classification-flow-v2 → classification-flow-v2.md)
- When creating files: Suggest full path (e.g. src/features/classification/components/ClassificationTable.tsx)
- When moving files: Update all imports/references automatically
- Preserve Next.js conventions: app/, public/, prisma/migrations/
- For agent outputs (.ralph/): Keep active guardrails in docs/ralph/, archive old iterations to _archive/docs/ralph/

## Archiving Old Code
- Move superseded code to `_archive/` (top-level, excluded from TypeScript via tsconfig.json)
- Organize by type: `_archive/api/`, `_archive/services/`, `_archive/components/`, `_archive/docs/`
- Do NOT archive inside src/ — it will still be compiled by Next.js/TypeScript
- When archiving: No need to fix imports in archived files (they're excluded from compilation)

Always propose locations following this structure. Remind if I suggest something that violates it.